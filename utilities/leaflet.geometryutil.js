(function(b){var a;if(typeof define==="function"&&define.amd){define(["leaflet"],b)}else{if(typeof module!=="undefined"){a=require("leaflet");module.exports=b(a)}else{if(typeof window.L==="undefined"){throw"Leaflet must be loaded first"}b(window.L)}}}(function(a){a.Polyline._flat=a.LineUtil.isFlat||a.Polyline._flat||function(b){return !a.Util.isArray(b[0])||(typeof b[0][0]!=="object"&&typeof b[0][0]!=="undefined")};a.GeometryUtil=a.extend(a.GeometryUtil||{},{distance:function(d,c,b){return d.latLngToLayerPoint(c).distanceTo(d.latLngToLayerPoint(b))},distanceSegment:function(f,h,c,b){var e=f.latLngToLayerPoint(h),g=f.latLngToLayerPoint(c),d=f.latLngToLayerPoint(b);return a.LineUtil.pointToSegmentDistance(e,g,d)},readableDistance:function(e,c){var b=(c!=="imperial"),d;if(b){if(e>1000){d=(e/1000).toFixed(2)+" km"}else{d=Math.ceil(e)+" m"}}else{e*=1.09361;if(e>1760){d=(e/1760).toFixed(2)+" miles"}else{d=Math.ceil(e)+" yd"}}return d},belongsSegment:function(g,d,c,b){b=b===undefined?0.2:b;var e=d.distanceTo(c),f=d.distanceTo(g)+g.distanceTo(c)-e;return f/e<b},length:function(c){var b=a.GeometryUtil.accumulatedLengths(c);return b.length>0?b[b.length-1]:0},accumulatedLengths:function(d){if(typeof d.getLatLngs=="function"){d=d.getLatLngs()}if(d.length===0){return[]}var c=0,f=[0];for(var b=0,e=d.length-1;b<e;b++){c+=d[b].distanceTo(d[b+1]);f.push(c)}return f},closestOnSegment:function(b,e,g,f){var h=b.getMaxZoom();if(h===Infinity){h=b.getZoom()}var d=b.project(e,h),j=b.project(g,h),i=b.project(f,h),c=a.LineUtil.closestPointOnSegment(d,j,i);return b.unproject(c,h)},closest:function(d,l,f,m){var b,k=Infinity,r=null,j,h,c,q;if(l instanceof Array){if(l[0] instanceof Array&&typeof l[0][0]!=="number"){for(j=0;j<l.length;j++){q=a.GeometryUtil.closest(d,l[j],f,m);if(q.distance<k){k=q.distance;r=q}}return r}else{if(l[0] instanceof a.LatLng||typeof l[0][0]==="number"||typeof l[0].lat==="number"){l=a.polyline(l)}else{return r}}}if(!(l instanceof a.Polyline)){return r}b=JSON.parse(JSON.stringify(l.getLatLngs().slice(0)));if(l instanceof a.Polygon){var p=function(n){if(a.Polyline._flat(n)){n.push(n[0])}else{for(var s=0;s<n.length;s++){p(n[s])}}};p(b)}if(!a.Polyline._flat(b)){for(j=0;j<b.length;j++){q=a.GeometryUtil.closest(d,b[j],f,m);if(q.distance<k){k=q.distance;r=q}}return r}else{if(m){for(j=0,h=b.length;j<h;j++){var o=b[j];c=a.GeometryUtil.distance(d,f,o);if(c<k){k=c;r=o;r.distance=c}}return r}for(j=0,h=b.length;j<h-1;j++){var g=b[j],e=b[j+1];c=a.GeometryUtil.distanceSegment(d,f,g,e);if(c<=k){k=c;r=a.GeometryUtil.closestOnSegment(d,f,g,e);r.distance=c}}return r}},closestLayer:function(c,f,d){var h=Infinity,m=null,k=null,b=Infinity;for(var g=0,e=f.length;g<e;g++){var j=f[g];if(j instanceof a.LayerGroup){var l=a.GeometryUtil.closestLayer(c,j.getLayers(),d);if(l.distance<h){h=l.distance;m=l}}else{if(typeof j.getLatLng=="function"){k=j.getLatLng();b=a.GeometryUtil.distance(c,d,k)}else{k=a.GeometryUtil.closest(c,j,d);if(k){b=k.distance}}if(b<h){h=b;m={layer:j,latlng:k,distance:b}}}}return m},nClosestLayers:function(c,g,d,e){e=typeof e==="number"?e:g.length;if(e<1||g.length<1){return null}var h=[];var b,l;for(var j=0,f=g.length;j<f;j++){var k=g[j];if(k instanceof a.LayerGroup){var o=a.GeometryUtil.closestLayer(c,k.getLayers(),d);h.push(o)}else{if(typeof k.getLatLng=="function"){l=k.getLatLng();b=a.GeometryUtil.distance(c,d,l)}else{l=a.GeometryUtil.closest(c,k,d);if(l){b=l.distance}}h.push({layer:k,latlng:l,distance:b})}}h.sort(function(m,i){return m.distance-i.distance});if(h.length>e){return h.slice(0,e)}else{return h}},layersWithin:function(c,f,d,k){k=typeof k=="number"?k:Infinity;var g=[];var l=null;var b=0;for(var h=0,e=f.length;h<e;h++){var j=f[h];if(typeof j.getLatLng=="function"){l=j.getLatLng();b=a.GeometryUtil.distance(c,d,l)}else{l=a.GeometryUtil.closest(c,j,d);if(l){b=l.distance}}if(l&&b<k){g.push({layer:j,latlng:l,distance:b})}}var m=g.sort(function(n,i){return n.distance-i.distance});return m},closestLayerSnap:function(f,e,h,c,g){c=typeof c=="number"?c:Infinity;g=typeof g=="boolean"?g:true;var b=a.GeometryUtil.closestLayer(f,e,h);if(!b||b.distance>c){return null}if(g&&typeof b.layer.getLatLngs=="function"){var d=a.GeometryUtil.closest(f,b.layer,b.latlng,true);if(d.distance<c){b.latlng=d;b.distance=a.GeometryUtil.distance(f,d,h)}}return b},interpolateOnPointSegment:function(c,b,d){return a.point((c.x*(1-d))+(d*b.x),(c.y*(1-d))+(d*b.y))},interpolateOnLine:function(c,f,m){f=(f instanceof a.Polyline)?f.getLatLngs():f;var e=f.length;if(e<2){return null}m=Math.max(Math.min(m,1),0);if(m===0){return{latLng:f[0] instanceof a.LatLng?f[0]:a.latLng(f[0]),predecessor:-1}}if(m==1){return{latLng:f[f.length-1] instanceof a.LatLng?f[f.length-1]:a.latLng(f[f.length-1]),predecessor:f.length-2}}var g=c.getMaxZoom();if(g===Infinity){g=c.getZoom()}var r=[];var d=0;for(var h=0;h<e;h++){r[h]=c.project(f[h],g);if(h>0){d+=r[h-1].distanceTo(r[h])}}var k=d*m;var q=0,o=0;for(var h=0;o<k;h++){var b=r[h],p=r[h+1];q=o;o+=b.distanceTo(p)}if(b==undefined&&p==undefined){var b=r[0],p=r[1],h=1}var j=((o-q)!==0)?((k-q)/(o-q)):0;var l=a.GeometryUtil.interpolateOnPointSegment(b,p,j);return{latLng:c.unproject(l,g),predecessor:h-1}},locateOnLine:function(c,l,d){var b=l.getLatLngs();if(d.equals(b[0])){return 0}if(d.equals(b[b.length-1])){return 1}var m=a.GeometryUtil.closest(c,l,d,false),h=a.GeometryUtil.accumulatedLengths(b),k=h[h.length-1],p=0,o=false;for(var j=0,e=b.length-1;j<e;j++){var g=b[j],f=b[j+1];p=h[j];if(a.GeometryUtil.belongsSegment(m,g,f)){p+=g.distanceTo(m);o=true;break}}if(!o){throw"Could not interpolate "+d.toString()+" within "+l.toString()}return p/k},reverse:function(b){return a.polyline(b.getLatLngs().slice(0).reverse())},extract:function(c,g,d,e){if(d>e){return a.GeometryUtil.extract(c,a.GeometryUtil.reverse(g),1-d,1-e)}d=Math.max(Math.min(d,1),0);e=Math.max(Math.min(e,1),0);var b=g.getLatLngs(),f=a.GeometryUtil.interpolateOnLine(c,g,d),i=a.GeometryUtil.interpolateOnLine(c,g,e);if(d==e){var h=a.GeometryUtil.interpolateOnLine(c,g,e);return[h.latLng]}if(f.predecessor==-1){f.predecessor=0}if(i.predecessor==-1){i.predecessor=0}var j=b.slice(f.predecessor+1,i.predecessor+1);j.unshift(f.latLng);j.push(i.latLng);return j},isBefore:function(c,b){if(!b){return false}var e=c.getLatLngs(),d=b.getLatLngs();return(e[e.length-1]).equals(d[0])},isAfter:function(c,b){if(!b){return false}var e=c.getLatLngs(),d=b.getLatLngs();return(e[0]).equals(d[d.length-1])},startsAtExtremity:function(c,b){if(!b){return false}var e=c.getLatLngs(),d=b.getLatLngs(),f=e[0];return f.equals(d[0])||f.equals(d[d.length-1])},computeAngle:function(d,c){return(Math.atan2(c.y-d.y,c.x-d.x)*180/Math.PI)},computeSlope:function(d,c){var e=(c.y-d.y)/(c.x-d.x),f=d.y-(e*d.x);return{a:e,b:f}},rotatePoint:function(c,d,e,i){var f=c.getMaxZoom();if(f===Infinity){f=c.getZoom()}var h=e*Math.PI/180,j=c.project(d,f),k=c.project(i,f),b=Math.cos(h)*(j.x-k.x)-Math.sin(h)*(j.y-k.y)+k.x,g=Math.sin(h)*(j.x-k.x)+Math.cos(h)*(j.y-k.y)+k.y;return c.unproject(new a.Point(b,g),f)},bearing:function(j,i){var f=Math.PI/180,c=j.lat*f,b=i.lat*f,e=j.lng*f,d=i.lng*f,g=Math.sin(d-e)*Math.cos(b),h=Math.cos(c)*Math.sin(b)-Math.sin(c)*Math.cos(b)*Math.cos(d-e);var k=((Math.atan2(g,h)*180/Math.PI)+360)%360;return k>=180?k-360:k},destination:function(c,p,b){p=(p+360)%360;var m=Math.PI/180,o=180/Math.PI,h=6378137,k=c.lng*m,g=c.lat*m,e=p*m,l=Math.sin(g),j=Math.cos(g),f=Math.cos(b/h),n=Math.sin(b/h),d=Math.asin(l*f+j*n*Math.cos(e)),i=k+Math.atan2(Math.sin(e)*n*j,f-l*Math.sin(d));i=i*o;i=i>180?i-360:i<-180?i+360:i;return a.latLng([d*o,i])},angle:function(f,e,d){var b=f.latLngToContainerPoint(e),g=f.latLngToContainerPoint(d),c=Math.atan2(g.y-b.y,g.x-b.x)*180/Math.PI+90;c+=c<0?360:0;return c},destinationOnSegment:function(e,d,c,g){var b=a.GeometryUtil.angle(e,d,c),f=a.GeometryUtil.destination(d,b,g);return a.GeometryUtil.closestOnSegment(e,f,d,c)},});return a.GeometryUtil}));
